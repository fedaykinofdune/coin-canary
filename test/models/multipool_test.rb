require 'test_helper'

class MultipoolTest < ActiveSupport::TestCase
  setup do
    fake_multipool
  end

  test "coin.current should return the currency with the highest hashrate and the hashrate" do
    assert_equal({ name: "nvc", hashrate: 608 }, Multipool::Coin.current)
  end

  test "worker.all should return workers name and status" do
    assert_equal({
      "alexp.w1" => :online,
      "alexp.w2" => :offline
    }, Multipool::Worker.all)
  end

  private

  def fake_multipool
    fake_response = stub(code: 200, parsed_response: JSON.parse(fake_json_response))
    HTTParty.expects(:get).at_least(1).returns(fake_response)
  end

  def fake_json_response
    %Q({"currency":{"arg":{"confirmed_rewards":"0.0000000000000000","hashrate":"0","round_shares":false,"block_shares":"0","estimated_rewards":"0","payout_history":"3.30132","pool_hashrate":"1714"},"aur":{"confirmed_rewards":"0.3094377100000000","hashrate":"203","round_shares":"1088","block_shares":"0","estimated_rewards":"0.00254986","payout_history":"0.237277","pool_hashrate":"1122720"},"btc":{"confirmed_rewards":"0.0000000000000000","hashrate":"0","round_shares":false,"block_shares":"0","estimated_rewards":0,"payout_history":"0","pool_hashrate":"173774552"},"cap":{"confirmed_rewards":"0.3543424606323242","hashrate":"0","round_shares":false,"block_shares":"0","estimated_rewards":"0","payout_history":"0.0553844","pool_hashrate":"5403"},"cgb":{"confirmed_rewards":"0.0223065223544836","hashrate":"0","round_shares":false,"block_shares":"0","estimated_rewards":"0","payout_history":"0","pool_hashrate":"3182"},"dgc":{"confirmed_rewards":"0.5184284910000000","hashrate":"0","round_shares":false,"block_shares":"0","estimated_rewards":"0","payout_history":"5.21365","pool_hashrate":"7919"},"dmd":{"confirmed_rewards":"0.0788417763000000","hashrate":"0","round_shares":false,"block_shares":"0","estimated_rewards":"0","payout_history":"0","pool_hashrate":"29430"},"doge":{"confirmed_rewards":"1447.9910560000000000","hashrate":"329","round_shares":"1472","block_shares":"0","estimated_rewards":"7.82714","payout_history":"2080710","pool_hashrate":"9135575"},"dvc":{"confirmed_rewards":"0.0000000000000000","hashrate":0,"round_shares":false,"block_shares":"0","estimated_rewards":0,"payout_history":"0","pool_hashrate":false},"eac":{"confirmed_rewards":"210.8496700000000000","hashrate":"56","round_shares":"64","block_shares":"0","estimated_rewards":"1.03098","payout_history":"0","pool_hashrate":"319061"},"frc":{"confirmed_rewards":"0.0000000000000000","hashrate":"0","round_shares":false,"block_shares":"0","estimated_rewards":"0","payout_history":"0","pool_hashrate":"2391352"},"ftc":{"confirmed_rewards":"1.1196240400000000","hashrate":"0","round_shares":"384","block_shares":"0","estimated_rewards":"0.00737599","payout_history":"3.16124","pool_hashrate":"24153"},"gdc":{"confirmed_rewards":"0.0000000000000000","hashrate":"0","round_shares":false,"block_shares":"0","estimated_rewards":"0","payout_history":"0","pool_hashrate":"3686"},"ixc":{"confirmed_rewards":"0.0000000000000000","hashrate":0,"round_shares":false,"block_shares":"0","estimated_rewards":0,"payout_history":"0","pool_hashrate":false},"lky":{"confirmed_rewards":"0.2499949599999999","hashrate":"0","round_shares":false,"block_shares":"0","estimated_rewards":"0","payout_history":"3.30447","pool_hashrate":"8830"},"lot":{"confirmed_rewards":"0.0000000000000000","hashrate":"0","round_shares":false,"block_shares":"0","estimated_rewards":"0","payout_history":"0","pool_hashrate":"18001"},"ltc":{"confirmed_rewards":"0.1206826000000000","hashrate":"0","round_shares":"2240","block_shares":"0","estimated_rewards":"0.00240312","payout_history":"0.10398","pool_hashrate":"453327"},"mec":{"confirmed_rewards":"0.1623106600000000","hashrate":"0","round_shares":false,"block_shares":"0","estimated_rewards":"0","payout_history":"2.96725","pool_hashrate":"10528"},"mnc":{"confirmed_rewards":"0.0000000000000000","hashrate":"0","round_shares":false,"block_shares":"0","estimated_rewards":"0","payout_history":"1.1611","pool_hashrate":"1026"},"moon":{"confirmed_rewards":"0.0000000000000000","hashrate":"0","round_shares":false,"block_shares":"0","estimated_rewards":"0","payout_history":"0","pool_hashrate":"15493"},"nmc":{"confirmed_rewards":"0.0000000000000000","hashrate":0,"round_shares":false,"block_shares":"0","estimated_rewards":0,"payout_history":"0","pool_hashrate":false},"nvc":{"confirmed_rewards":"0.0696598700000000","hashrate":"608","round_shares":"128","block_shares":"0","estimated_rewards":"0","payout_history":"0","pool_hashrate":"3041242"},"ppc":{"confirmed_rewards":"0.0000000000000000","hashrate":"0","round_shares":false,"block_shares":"0","estimated_rewards":"0","payout_history":"0","pool_hashrate":"218429"},"pxc":{"confirmed_rewards":"0.0000000000000000","hashrate":"0","round_shares":false,"block_shares":"0","estimated_rewards":"0","payout_history":"0","pool_hashrate":"2141"},"tips":{"confirmed_rewards":"0.0000000000000000","hashrate":"0","round_shares":false,"block_shares":"0","estimated_rewards":"0","payout_history":"0","pool_hashrate":"99600"},"trc":{"confirmed_rewards":"0.0000000000000000","hashrate":"0","round_shares":false,"block_shares":"0","estimated_rewards":"0","payout_history":"0","pool_hashrate":"2324826"},"wdc":{"confirmed_rewards":"1.5126053400000000","hashrate":"0","round_shares":"192","block_shares":"0","estimated_rewards":"0.00630418","payout_history":"17.2822","pool_hashrate":"25700"},"zet":{"confirmed_rewards":"0.0000000000000000","hashrate":"0","round_shares":false,"block_shares":"0","estimated_rewards":"0","payout_history":"0","pool_hashrate":"2556733"}},"workers":{"arg":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"0"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"aur":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"203"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"btc":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"0"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"cap":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"0"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"cgb":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"0"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"dgc":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"0"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"dmd":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"0"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"doge":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"329"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"eac":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"56"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"frc":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"0"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"ftc":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"0"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"gdc":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"0"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"lky":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"0"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"lot":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"0"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"ltc":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"0"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"mec":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"0"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"mnc":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"0"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"moon":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"0"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"nvc":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"608"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"ppc":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"0"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"pxc":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"0"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"tips":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"0"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"trc":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"0"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"wdc":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"0"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}},"zet":{"alexp.1":{"hashrate":"0"},"alexp.doge":{"hashrate":"0"},"alexp.w1":{"hashrate":"0"},"alexp.w2":{"hashrate":"0"},"alexp.w3":{"hashrate":"0"}}}})
  end
end
